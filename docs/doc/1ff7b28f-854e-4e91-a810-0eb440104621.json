{
    "summary": "The TCDemand.m file updates energy values, demand pool, and decision loop in the AIThinkingControl module, syncing outModelManager data, managing child tasks, recognizing results, and updating operCount. It also updates 'theTV' frame and searches for nodes in a demand dictionary, logging Fo information.",
    "details": [
        {
            "comment": "TCDemand.m file contains methods for updating energy values, demand pool, and making decision loop in AIThinkingControl module of the codebase. The rDemand method predicts and updates CMVCache, while pDemand updates energy, demandManager, and performs dataOut decisions.",
            "location": "\"/media/root/Prima/works/he4o/docs/src/SMG_NothingIsAll/AIFoundation/AIThinkingControl/TCDemand/TCDemand.m\":0-40",
            "content": "//\n//  TCDemand.m\n//  SMG_NothingIsAll\n//\n//  Created by jia on 2021/11/28.\n//  Copyright \u00a9 2021\u5e74 XiaoGang. All rights reserved.\n//\n#import \"TCDemand.h\"\n@implementation TCDemand\n/**\n *  MARK:--------------------r\u9884\u6d4b--------------------\n *  @version\n *      2021.12.05: \u539f\u672c\u53ea\u6709tor\u53d7\u963b\u65f6\u624d\u6267\u884csolution,\u73b0\u6539\u4e3a\u4e0d\u4f9d\u8d56tor,\u56e0\u4e3ator\u6539\u5230\u6982\u5ff5\u8bc6\u522b\u4e4b\u540e\u4e86 (\u53c2\u800324171-9);\n */\n+(NSArray*) rDemand:(AIShortMatchModel*)model protoFo:(AIFoNodeBase*)protoFo{\n    //2. \u9884\u6d4b\u5904\u7406_\u628amv\u52a0\u5165\u5230demandManager;\n    [theTC updateOperCount:kFILENAME];\n    Debug();\n    OSTitleLog(@\"rDemand\");\n    NSArray *newRoots = [theTC.outModelManager updateCMVCache_RMV:model protoFo:protoFo];\n    dispatch_async(dispatch_get_main_queue(), ^{//30083\u56de\u540c\u6b65\n        [theTV updateFrame];\n    });\n    DebugE();\n    return newRoots;\n}\n/**\n *  MARK:--------------------p\u4efb\u52a1--------------------\n *  @desc \u529f\u80fd\u8bf4\u660e:\n *      1. \u66f4\u65b0energy\u503c\n *      2. \u66f4\u65b0\u9700\u6c42\u6c60\n *      3. \u8fdb\u884cdataOut\u51b3\u7b56\u884c\u4e3a\u5316;\n */\n+(void) pDemand:(AICMVNode*)cmvNode{\n    //1. \u5c06\u8054\u60f3\u5230\u7684cmv\u66f4\u65b0energy & \u66f4\u65b0demandManager & decisionLoop\n    [theTC updateOperCount:kFILENAME];\n    Debug();"
        },
        {
            "comment": "This code snippet updates the outModelManager with CMV cache data, triggers subDemand to generate subtasks based on the feedback, and manages pFos as child tasks. It also handles recognizing results and updating operCount for further processing.",
            "location": "\"/media/root/Prima/works/he4o/docs/src/SMG_NothingIsAll/AIFoundation/AIThinkingControl/TCDemand/TCDemand.m\":41-66",
            "content": "    OSTitleLog(@\"pDemand\");\n    NSInteger delta = [NUMTOOK([AINetIndex getData:cmvNode.delta_p]) integerValue];\n    NSString *algsType = cmvNode.urgentTo_p.algsType;\n    NSInteger urgentTo = [NUMTOOK([AINetIndex getData:cmvNode.urgentTo_p]) integerValue];\n    [theTC.outModelManager updateCMVCache_PMV:algsType urgentTo:urgentTo delta:delta];\n    dispatch_async(dispatch_get_main_queue(), ^{//30083\u56de\u540c\u6b65\n        [theTV updateFrame];\n    });\n    //2. \u8f6c\u5411\u6267\u884c;\n    DebugE();\n    [TCScore scoreFromIfTCNeed];\n}\n/**\n *  MARK:--------------------\u53cd\u601d\u8bc6\u522b\u5f62\u6210\u5b50\u4efb\u52a1--------------------\n *  @version\n *      2021.12.06: \u53cd\u9988feedback\u540e\u751f\u6210\u5b50\u4efb\u52a1,\u4f46\u5e76\u4e0d\u89e6\u53d1solution\u51b3\u7b56 (\u53c2\u800324171-9de);\n *  @todo\n *      2022.03.11: \u6839\u636efos4Demand\u751f\u6210\u5b50\u4efb\u52a1\u540e,\u6839\u636e\u5b83\u7684mvScoreV2\u9650\u5236\u5b83\u7684\u4e0b\u8f96\u5206\u652f\u6570 (\u53c2\u800325142-TODO3);\n *      2022.05.18: \u591apFos\u5f62\u6210\u5355\u4e2a\u4efb\u52a1 (\u53c2\u800326042-TODO1);\n *      2023.07.07: \u4ee5\u524d\u662f\u53cd\u9988\u540e\u53cd\u601d\u8bc6\u522b,\u73b0\u5728\u6539\u6210\u884c\u4e3a\u5316\u524d\u53cd\u601d\u8bc6\u522b,\u4f46\u6700\u7ec8\u90fd\u7531\u6b64\u5904\u751f\u6210\u5b50\u4efb\u52a1 (\u53c2\u800330054-todo5);\n */\n+(void) subDemand:(AIShortMatchModel*)model foModel:(TOFoModel*)foModel{\n    //1. \u8bc6\u522b\u7ed3\u679cpFos\u6302\u8f7d\u5230targetFoModel\u4e0b\u505a\u5b50\u4efb\u52a1 (\u597d\u7684\u574f\u7684\u5168\u6302\u8f7d,\u6bd4\u5982\u505a\u7684\u996d\u6211\u7231\u5403{MV+},\u4f46\u662f\u53c8\u592a\u9ebb\u70e6{MV-});\n    [theTC updateOperCount:kFILENAME];"
        },
        {
            "comment": "Debugging function and dictionary declaration. Iterates through the demand dictionary, creates a new ReasonDemandModel for each key-value pair, searches for a corresponding node, and logs information about the match Fo. Finally, updates the TV frame on the main queue.",
            "location": "\"/media/root/Prima/works/he4o/docs/src/SMG_NothingIsAll/AIFoundation/AIThinkingControl/TCDemand/TCDemand.m\":67-93",
            "content": "    Debug();\n    NSDictionary *fos4Demand = model.fos4Demand;\n    OFTitleLog(@\"subDemand\",@\"\\n\u5b50\u4efb\u52a1\u6570:%ld baseFo:%@\",fos4Demand.count,Pit2FStr(foModel.content_p));\n    for (NSString *atKey in fos4Demand.allKeys) {\n        NSArray *pFosValue = [fos4Demand objectForKey:atKey];\n        [ReasonDemandModel newWithAlgsType:atKey pFos:pFosValue shortModel:model baseFo:foModel protoFo:model.protoFo];\n        for (AIMatchFoModel *pFo in pFosValue) {\n            AIFoNodeBase *pFoNode = [SMGUtils searchNode:pFo.matchFo];\n            NSLog(@\"\\t pFo:%@->{%@%.2f}\",Pit2FStr(pFo.matchFo),ClassName2Str(pFoNode.cmvNode_p.algsType),[AIScore score4MV_v2FromCache:pFo]);\n        }\n    }\n    dispatch_async(dispatch_get_main_queue(), ^{//30083\u56de\u540c\u6b65\n        [theTV updateFrame];\n    });\n    DebugE();\n}\n/**\n *  MARK:--------------------hDemand--------------------\n *  @version\n *      2021.12.19: \u6539\u4e3a\u8c03\u7528TCScore\u800c\u4e0d\u662fhSolution;\n */\n+(void) hDemand:(TOAlgModel*)algModel{\n    //1. \u5bf9algModel\u751f\u6210H\u4efb\u52a1,\u5e76\u6302\u8f7d\u5728\u5f53\u524d\u77ed\u65f6\u8bb0\u5fc6\u5206\u652f\u4e0b;\n    [theTC updateOperCount:kFILENAME];\n    Debug();"
        },
        {
            "comment": "This code updates the frame of 'theTV' after synchronizing on the main queue, and then calls TCScore to continue decision-making.",
            "location": "\"/media/root/Prima/works/he4o/docs/src/SMG_NothingIsAll/AIFoundation/AIThinkingControl/TCDemand/TCDemand.m\":94-105",
            "content": "    OFTitleLog(@\"hDemand\",@\"\\n%@\",Pit2FStr(algModel.content_p));\n    [HDemandModel newWithAlgModel:algModel];\n    dispatch_async(dispatch_get_main_queue(), ^{//30083\u56de\u540c\u6b65\n        [theTV updateFrame];\n    });\n    //2. \u8c03\u7528TCScore\u7ee7\u7eed\u51b3\u7b56;\n    DebugE();\n    [TCScore scoreFromIfTCNeed];\n}\n@end"
        }
    ]
}