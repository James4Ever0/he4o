{
    "summary": "The code initializes a ReasonDemandModel object, prepares data, and defines methods for valid pFos, task expiration, and obtaining proto/regroup fo. It also provides an NSCoding implementation for encoding/decoding properties using specified keys in the coder.",
    "details": [
        {
            "comment": "This code is creating a ReasonDemandModel object and initializing its properties based on the provided parameters. It prepares data for the model by assigning values to certain attributes, such as delta and urgentTo, which are derived from the matching FO (firstPFo) and CMV nodes (mvNode). The code also calculates the value of urgentTo using a specific formula that involves cutting index plus 1.",
            "location": "\"/media/root/Prima/works/he4o/docs/src/SMG_NothingIsAll/AIFoundation/AIThinkingControl/TCDemand/Model/ReasonDemandModel.m\":0-26",
            "content": "//\n//  ReasonDemandModel.m\n//  SMG_NothingIsAll\n//\n//  Created by jia on 2021/1/21.\n//  Copyright \u00a9 2021\u5e74 XiaoGang. All rights reserved.\n//\n#import \"ReasonDemandModel.h\"\n@implementation ReasonDemandModel\n/**\n *  MARK:--------------------newWith--------------------\n *  @version\n *      2021.03.28: \u5c06at & delta & urgentTo\u4e5f\u5c01\u88c5\u5230\u6b64\u5904\u53d6\u8d4b\u503c;\n *      2021.06.01: \u5c06\u5b50\u4efb\u52a1\u65f6\u7684base\u4e5f\u517c\u5bb9\u5165baseOrGroup\u4e2d (\u53c2\u800323094);\n */\n+(ReasonDemandModel*) newWithAlgsType:(NSString*)algsType pFos:(NSArray*)pFos shortModel:(AIShortMatchModel*)shortModel baseFo:(TOFoModel*)baseFo protoFo:(AIFoNodeBase*)protoFo{\n    //1. \u6570\u636e\u51c6\u5907;\n    ReasonDemandModel *result = [[ReasonDemandModel alloc] init];\n    AIMatchFoModel *firstPFo = ARR_INDEX(pFos, 0);\n    AIFoNodeBase *matchFo = [SMGUtils searchNode:firstPFo.matchFo];\n    AICMVNodeBase *mvNode = [SMGUtils searchNode:matchFo.cmvNode_p];\n    NSInteger delta = [NUMTOOK([AINetIndex getData:mvNode.delta_p]) integerValue];\n    NSInteger urgentTo = [NUMTOOK([AINetIndex getData:mvNode.urgentTo_p]) integerValue];\n    urgentTo = (int)(urgentTo * (firstPFo.cutIndex + 1));"
        },
        {
            "comment": "This code defines a class with methods for retrieving valid pFos, determining if the task is expired based on its pFos, and obtaining the proto or regroup fo. The methods filter out invalid pFos, check the status of each pFo, and handle the overall state of the task based on the pFos.",
            "location": "\"/media/root/Prima/works/he4o/docs/src/SMG_NothingIsAll/AIFoundation/AIThinkingControl/TCDemand/Model/ReasonDemandModel.m\":28-68",
            "content": "    //2. \u77ed\u65f6\u7ed3\u6784;\n    if (baseFo) [baseFo.subDemands addObject:result];\n    result.baseOrGroup = baseFo;\n    //3. \u5c5e\u6027\u8d4b\u503c;\n    result.algsType = algsType;\n    result.delta = delta;\n    result.urgentTo = urgentTo;\n    result.pFos = pFos;\n    result.fromIden = STRFORMAT(@\"%p\",shortModel);\n    result.protoFo = protoFo.pointer;\n    result.regroupFo = shortModel.regroupFo.pointer;\n    //4. pFos\u8d4b\u503cbaseRDemand;\n    for (AIMatchFoModel *pFo in pFos) {\n        pFo.baseRDemand = result;\n    }\n    return result;\n}\n/**\n *  MARK:--------------------\u4efb\u52a1\u7684pFos--------------------\n *  @desc \u9ed8\u8ba4\u8fd4\u56de\u672a\u5931\u6548\u7684pFos\u4efb\u52a1 (\u4e5f\u53ef\u4ee5\u8003\u8651\u6539\u6210\u5931\u6548\u65f6,\u76f4\u63a5\u79fb\u9664\u5931\u6548\u7684pFo) (\u53c2\u800327095-10);\n */\n-(NSArray*) validPFos {\n    return [SMGUtils filterArr:_pFos checkValid:^BOOL(AIMatchFoModel *item) {\n        return !item.isExpired;\n    }];\n}\n-(AIKVPointer*) protoOrRegroupFo {\n    if (self.protoFo) return self.protoFo;\n    return self.regroupFo;\n}\n/**\n *  MARK:--------------------\u4efb\u52a1\u662f\u5426\u5931\u6548--------------------\n *  @desc : \u5f53R\u4efb\u52a1\u7684pFos\u5168\u5931\u6548\u65f6,\u5219R\u4efb\u52a1\u4e5f\u5931\u6548 (\u53c2\u800327123-\u95ee\u98982-todo1);\n */\n-(BOOL) isExpired {\n    return !ARRISOK(self.validPFos);"
        },
        {
            "comment": "This code defines an NSCoding protocol implementation for a class, providing methods to initialize with a coder and encode values using a coder. The class has properties pFos, fromIden, protoFo, and regroupFo which are encoded and decoded using the specified keys in the coder.",
            "location": "\"/media/root/Prima/works/he4o/docs/src/SMG_NothingIsAll/AIFoundation/AIThinkingControl/TCDemand/Model/ReasonDemandModel.m\":69-93",
            "content": "}\n/**\n *  MARK:--------------------NSCoding--------------------\n */\n- (nullable instancetype)initWithCoder:(NSCoder *)aDecoder {\n    self = [super initWithCoder:aDecoder];\n    if (self) {\n        self.pFos = [aDecoder decodeObjectForKey:@\"pFos\"];\n        self.fromIden = [aDecoder decodeObjectForKey:@\"fromIden\"];\n        self.protoFo = [aDecoder decodeObjectForKey:@\"protoFo\"];\n        self.regroupFo = [aDecoder decodeObjectForKey:@\"regroupFo\"];\n    }\n    return self;\n}\n- (void)encodeWithCoder:(NSCoder *)aCoder {\n    [super encodeWithCoder:aCoder];\n    [aCoder encodeObject:self.pFos forKey:@\"pFos\"];\n    [aCoder encodeObject:self.fromIden forKey:@\"fromIden\"];\n    [aCoder encodeObject:self.protoFo forKey:@\"protoFo\"];\n    [aCoder encodeObject:self.regroupFo forKey:@\"regroupFo\"];\n}\n@end"
        }
    ]
}