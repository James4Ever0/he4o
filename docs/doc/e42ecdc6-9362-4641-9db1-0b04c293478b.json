{
    "summary": "The code implements a spiral architecture action in the SMG_NothingIsAll project, converts solutions to behavior, follows an iterative process with feedback, supports hAction, handles target frames using spIndex, updates for fixes since Nov 2021, evaluates downgrade urgency, manages demand types, triggers actions based on type and results, logs progress, and returns a result upon action completion.",
    "details": [
        {
            "comment": "This code is implementing a new spiral architecture action in the SMG_NothingIsAll project. It solves problems by converting the solution into behavior (reference 24132-behaviorization) and follows an iterative process involving feedbackTOR and reflecting on previous rounds. The function takes a not-null foModel as input and has undergone several modifications since its creation in November 2021. It supports hAction, handles target frames using spIndex, and has undergone recent updates to fix issues with frame execution.",
            "location": "\"/media/root/Prima/works/he4o/docs/src/SMG_NothingIsAll/AIFoundation/AIThinkingControl/TCAction/TCAction.m\":0-29",
            "content": "//\n//  TCAction.m\n//  SMG_NothingIsAll\n//\n//  Created by jia on 2021/11/28.\n//  Copyright \u00a9 2021\u5e74 XiaoGang. All rights reserved.\n//\n#import \"TCAction.h\"\n#import \"TOFoModel.h\"\n@implementation TCAction\n/**\n *  MARK:--------------------\u65b0\u87ba\u65cb\u67b6\u6784action--------------------\n *  @desc \u89e3\u51b3\u65b9\u6848fo\u5373(\u52a0\u5de5\u76ee\u6807),\u8f6c_Fo()\u884c\u4e3a\u5316 (\u53c2\u800324132-\u884c\u4e3a\u53161);\n *  @param foModel : notnull\n *  @version\n *      2021.11.17: \u9700\u8c03\u7528\u8005\u81ea\u884c\u5bf9foModel\u8fdb\u884cFRS\u7a33\u5b9a\u6027\u7ade\u4e89\u8bc4\u4ef7,\u672c\u65b9\u6cd5\u4e0d\u518d\u8fdb\u884c (\u56e0\u4e3afo\u95f4\u7684\u7ade\u4e89,\u9700\u7531\u5916\u754c,fo\u5185\u90e8\u95ee\u9898\u5728\u6b64\u65b9\u6cd5\u5185\u89e3\u51b3);\n *      2021.11.25: \u8fed\u4ee3\u4e3a\u529f\u80fd\u67b6\u6784 (\u53c2\u800324154-\u5355\u8f6e\u793a\u56fe);\n *      2021.11.25: H\u7c7b\u578b\u5728Action\u540e,\u6700\u7ec8\u884c\u4e3a\u5316\u5b8c\u6bd5\u540e,\u8c03\u7528hActYes\u540e,\u5728feedbackTOR\u53cd\u9988,\u5e76\u91cd\u7ec4\u53cd\u601d,\u4e0b\u8f6e\u5faa\u73af;\n *      2021.11.xx: \u5e9f\u5f03outReflect\u53cd\u601d\u529f\u80fd (\u5168\u90e8\u5f85\u5230inReflect\u7edf\u4e00\u518d\u53cd\u601d);\n *      2021.11.28: \u65f6\u95f4\u4e0d\u6025\u8bc4\u4ef7,\u6539\u4e3a: \u7d27\u6025\u60c5\u51b5 = \u89e3\u51b3\u65b9\u6848\u6240\u9700\u65f6\u95f4 > \u7236\u4efb\u52a1\u80fd\u7ed9\u7684\u65f6\u95f4 (\u53c2\u800324171-7);\n *      2021.12.01: \u652f\u6301hAction;\n *      2021.12.26: action\u5c06foModel\u6267\u884c\u5230spIndex\u4e4b\u524d\u4e00\u5e27 (25032-4);\n *      2021.12.26: hSolution\u8fbe\u5230\u76ee\u6807\u5e27\u8f6chActYes\u7684\u5904\u7406 (\u53c2\u800325031-9);\n *      2021.12.26: \u4e0b\u6807\u4e0d\u6025(\u5f04\u5de7\u6210\u62d9)\u8bc4\u4ef7,\u652f\u6301isOut=true\u7684\u60c5\u51b5 (\u53c2\u800325031-10);\n *      2022.05.19: \u5e9f\u5f03ARSTime\u8bc4\u4ef7 (\u53c2\u800326051);\n *      2022.12.09: \u4fee\u590d\u5c11\u6267\u884c\u4e86\u4e00\u5e27\u7684\u95ee\u9898 (\u540e16\u53f7\u53c8\u53d1\u73b0\u591a\u4e86\u4e00\u5e27,\u628atarget\u4e5f\u6267\u884c\u4e86,\u8fd9\u91cc9\u53f7\u65f6\u7684\u60c5\u51b5\u5df2\u7ecf\u5fd8\u4e86);\n *      2022.12.16: \u4fee\u590d\u591a\u6267\u884c\u4e86\u4e00\u5e27\u7684\u95ee\u9898 (\u5373target\u5e27\u4e0d\u5fc5\u884c\u4e3a\u5316,\u81ea\u7136\u53d1\u751f\u5373\u53ef);"
        },
        {
            "comment": "This code performs action selection for a behavioral model. It prepares data, checks if the previous action was successful, updates operation counts, and jumps to the next frame. If the previous action failed, it may attempt to solve sub-tasks before trying again.",
            "location": "\"/media/root/Prima/works/he4o/docs/src/SMG_NothingIsAll/AIFoundation/AIThinkingControl/TCAction/TCAction.m\":30-54",
            "content": " *      2023.07.08: \u4e3a\u907f\u514d\u8f93\u51fa\u884c\u4e3a\u6361\u4e86\u829d\u9ebb\u4e22\u4e86\u897f\u74dc,\u5728\u884c\u4e3a\u5316\u4e4b\u524d,\u5148\u8c03\u7528\u4e00\u4e0b\u53cd\u601d (\u53c2\u800330054);\n *      2023.08.21: \u5c06\u53cd\u601d\u901a\u8fc7\u4e0e\u5426\u4fdd\u7559\u4e0b\u6765,\u7528\u4e8e\u540e\u9762\u51b3\u7b56\u65f6\u6fc0\u6d3b\u5176\u5b50R\u8fd8\u662f\u5b50H\u4efb\u52a1\u505a\u5224\u65ad\u4f9d\u636e (\u53c2\u800330114-todo1);\n *  @callers : \u53ef\u4ee5\u4f9b_Demand\u548c_Hav\u7b49\u8c03\u7528;\n */\n+(TCResult*) action:(TOFoModel*)foModel{\n    //1. \u6570\u636e\u51c6\u5907\n    AIFoNodeBase *curFo = [SMGUtils searchNode:foModel.content_p];\n    //2. Alg\u8f6c\u79fb (\u4e0b\u5e27),\u6bcf\u6b21\u8c03\u7528action\u7acb\u9a6c\u5148\u8df3\u4e0bactionIndex\u4e3a\u5f53\u524d\u6b63\u51c6\u5907\u884c\u4e3a\u5316\u7684\u90a3\u4e00\u5e27;\n    foModel.actionIndex++;\n    OFTitleLog(@\"\u884c\u4e3a\u5316Fo\", @\"\\n\u7b2c %ld/%ld \u4e2a,\u65f6\u5e8f:%@\",foModel.actionIndex+1,curFo.count,Fo2FStr(curFo));\n    //3. \u8fdb\u884c\u53cd\u601d\u8bc6\u522b,\u5982\u679c\u4e0d\u901a\u8fc7\u65f6,\u56de\u5230TCScore\u53ef\u80fd\u4f1a\u5c1d\u8bd5\u5148\u89e3\u51b3\u5b50\u4efb\u52a1,\u901a\u8fc7\u65f6\u7ee7\u7eed\u884c\u4e3a\u5316 (\u53c2\u800330054-todo7);\n    [TCRegroup actionRegroup:foModel];\n    foModel.refrectionNo = ![TCRefrection actionRefrection:foModel];\n    if (foModel.refrectionNo) {\n        [TCScore scoreFromIfTCNeed];\n        return [[[TCResult new:false] mkMsg:@\"action\u53cd\u601d\u4e0d\u901a\u8fc7\"] mkStep:31];\n    }\n    [theTC updateOperCount:kFILENAME];\n    Debug();\n    //4. \u8df3\u8f6c\u4e0b\u5e27 (\u6700\u540e\u4e00\u5e27\u4e3a\u76ee\u6807,\u81ea\u7136\u53d1\u751f\u5373\u53ef,\u6b64\u524d\u5e27\u5219\u9700\u8981\u884c\u4e3a\u5316\u5b9e\u73b0);\n    if (foModel.actionIndex < foModel.targetSPIndex - 1) {\n        NSLog(@\"_Fo\u884c\u4e3a\u5316\u7b2c %ld/%ld \u4e2a: %@\",foModel.actionIndex+1,foModel.targetSPIndex,Fo2FStr(curFo));"
        },
        {
            "comment": "This code is preparing for the evaluation of \"downgrade not urgent\" in the context of a specific algorithm model. It checks if the base demand is of type R, and if not, it directly proceeds to \"ActYes\" status. If the base demand is of type R, it evaluates whether or not to proceed with the evaluation based on the ARS_Time result. If the evaluation fails, it moves to \"ActYes\" status and waits for a natural occurrence (referencing 22153-A2). Otherwise, it generates a TOAlgModel for the next frame and calls frameActYes() function for further processing.",
            "location": "\"/media/root/Prima/works/he4o/docs/src/SMG_NothingIsAll/AIFoundation/AIThinkingControl/TCAction/TCAction.m\":56-79",
            "content": "        //@desc: \u4e0b\u6807\u4e0d\u6025\u8bc4\u4ef7\u8bf4\u660e: R\u6a21\u5f0f_Hav\u9996\u5148\u662f\u4e3a\u4e86\u907f\u514dforecastAlg,\u5176\u6b21\u624d\u662f\u4e3a\u4e86\u8fbe\u6210curFo\u89e3\u51b3\u65b9\u6848 (\u53c2\u800322153);\n        //5. \u4e0b\u6807\u4e0d\u6025(\u5f04\u5de7\u6210\u62d9)\u8bc4\u4ef7_\u6570\u636e\u51c6\u5907 (\u53c2\u800324171-12);\n        //TODO: \u8003\u8651\u6539\u6210,\u53d6base\u6700\u8fd1\u7684\u4e00\u4e2aR\u4efb\u52a1;\n        //6. \u53ea\u6709R\u7c7b\u578b,\u624d\u53c2\u4e0e\u4e0b\u6807\u4e0d\u6025\u8bc4\u4ef7;\n        //ReasonDemandModel *baseDemand = (ReasonDemandModel*)foModel.baseOrGroup;\n        //if(ISOK(baseDemand, ReasonDemandModel.class)){\n        //    BOOL arsTime = [AIScore ARS_Time:foModel demand:baseDemand];\n        //    if (!arsTime) {\n        //        //7. \u8bc4\u4ef7\u4e0d\u901a\u8fc7,\u5219\u76f4\u63a5ActYes,\u7b49\u5f85\u5176\u81ea\u7136\u51fa\u73b0 (\u53c2\u800322153-A2);\n        //        DebugE();\n        //        NSLog(@\"==> arsTime\u5f04\u5de7\u6210\u62d9\u8bc4\u4ef7,\u5b50\u5f39\u518d\u98de\u4e00\u4f1a\u513f\");\n        //        moveAlg.status = TOModelStatus_ActYes;\n        //        [TCActYes arsTimeActYes:moveAlg];\n        //        return;\n        //    }\n        //}\n        //6. \u8f6c\u4e0b\u5e27: \u7406\u6027\u5e27\u5219\u751f\u6210TOAlgModel;\n        AIKVPointer *move_p = ARR_INDEX(curFo.content_ps, foModel.actionIndex);\n        TOAlgModel *moveAlg = [TOAlgModel newWithAlg_p:move_p group:foModel];\n        //7. \u8c03\u7528frameActYes();\n        [TCActYes frameActYes:foModel];\n        //8. \u5f53\u524d\u5e27\u662f\u7406\u6027\u5e27\u65f6: \u5c1d\u8bd5\u884c\u4e3a\u5f53\u524d\u5e27;"
        },
        {
            "comment": "This code handles different types of demands and triggers corresponding actions. It checks the type of demand (R, H, or Percept) and calls the appropriate action function accordingly. If the action is successful, it waits for feedback before proceeding. The code also includes logging statements to track progress. Finally, it returns a result message indicating that the action has finished.",
            "location": "\"/media/root/Prima/works/he4o/docs/src/SMG_NothingIsAll/AIFoundation/AIThinkingControl/TCAction/TCAction.m\":80-102",
            "content": "        DebugE();\n        return [TCOut run:moveAlg];\n    }else{\n        //8. R\u6210\u529f,\u8f6cactYes\u7b49\u5f85\u53cd\u9988 & \u89e6\u53d1\u53cd\u7701 (\u539f\u9012\u5f52\u53c2\u8003\u6d41\u7a0b\u63a7\u5236Finish\u7684\u6ce8\u91caversion-20200916 / \u53c2\u800322061-7);\n        DebugE();\n        NSLog(@\"_Fo\u884c\u4e3a\u5316: Finish %ld/%ld \u5230ActYes\",foModel.actionIndex+1,(long)curFo.count);\n        if (ISOK(foModel.baseOrGroup, ReasonDemandModel.class)) {\n            [TCActYes frameActYes:foModel];\n            //[TCScore scoreFromIfTCNeed];//r\u8f93\u51fa\u5b8c\u6210\u65f6,\u7ee7\u7eed\u51b3\u7b56;\n        }else if(ISOK(foModel.baseOrGroup, HDemandModel.class)){\n            //9. H\u76ee\u6807\u5e27\u53ea\u9700\u8981\u7b49 (\u8f6chActYes) (\u53c2\u800325031-9);\n            AIKVPointer *hTarget_p = ARR_INDEX(curFo.content_ps, foModel.actionIndex);\n            [TOAlgModel newWithAlg_p:hTarget_p group:foModel];\n            [TCActYes frameActYes:foModel];//h\u8f93\u51fa\u6210\u529f\u65f6,\u7b49\u5f85\u53cd\u9988;\n        }else if(ISOK(foModel.baseOrGroup, PerceptDemandModel.class)){\n            [TCActYes frameActYes:foModel];//p\u8f93\u51fa\u6210\u529f\u65f6,\u7b49\u5f85\u53cd\u9988;\n        }\n        return [[[TCResult new:true] mkMsg:@\"action finish\"] mkStep:32];\n    }\n}\n@end"
        }
    ]
}